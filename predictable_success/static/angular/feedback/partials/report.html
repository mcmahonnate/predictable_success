<div class="container" data-hj-masked>
    <h1>Employee Feedback Report</h1>
    <div class="panel">
        <div class="btn-group" style="margin-bottom: 20px">
            <label class="btn btn-default" ng-model="feedbackReport.reportType" btn-radio="'totals'">Show totals for each person</label>
            <label class="btn btn-default" ng-model="feedbackReport.reportType" btn-radio="'timestamps'">Show timestamps for each action</label>
        </div>
        <div style="width:300px;">
			<div class="form-group">
				<label for="startDate"><strong>Start Date</strong></label>
				<input id="startDate" ng-model="feedbackReport.startDate" name="startDate" class="form-control" />
			</div>
			<div class="form-group" style="margin:15px 0;">	
				<label for="endDate"><strong>End Date</strong></label>
				<input id="endDate" ng-model="feedbackReport.endDate" name="endDate" class="form-control" />
			</div>
			<span ng-click="feedbackReport.getFeedbackReport()" ng-disabled="!feedbackReport.startDate || !feedbackReport.endDate" class="btn btn-primary">Submit</span>
        </div>
    </div>
    <div>

        <div class="panel" ng-show="feedbackReport.reportTotals.length>0 && feedbackReport.reportType=='totals'">
            <button class="btn btn-default pull-right" type="button" ng-csv="feedbackReport.csvTotals" filename="feedback-report-totals{{feedbackReport.startDate | date:'yyyy-MM-dd'}}to{{feedbackReport.endDate | date:'yyyy-MM-dd'}}.csv" csv-header="['Id', 'Employee', 'Total I Requested', 'Total Responded to Me', 'Total Requested of Me',  'Total I Responded To', 'Total Unsolicited I Gave', 'Total Unsolicited I Received', 'Total Digests I Delivered', 'Total Digests I Received', 'Total Excels At Feedback I Gave That Was Helpful', 'Total Could Improve On Feedback I Gave That Was Helpful', 'Total Feedback I Gave That Was Helpful' ]">
                <span class="fa fa-download"></span> Download
            </button>

            <table class="table">
                <thead>
                    <tr>
                        <th></th>
                        <th>
                            <a href="" ng-click="feedbackReport.orderTotals('employee.full_name');"><strong>Employee</strong></a>
                            <span class="sortorder fa" ng-show="feedbackReport.predicateTotals === 'employee.full_name'" ng-class="feedbackReport.reverseTotals ? 'fa-caret-up' : 'fa-caret-down'"></span>
                        </th>
                        <th>
                            <a href="" ng-click="feedbackReport.orderTotals('total_i_requested');"><strong>I Requested</strong></a>
                            <span class="sortorder fa" ng-show="feedbackReport.predicateTotals === 'total_i_requested'" ng-class="feedbackReport.reverseTotals ? 'fa-caret-up' : 'fa-caret-down'"></span>
                        </th>
                        <th>
                            <a href="" ng-click="feedbackReport.orderTotals('total_responded_to_me');"><strong>Responded to Me</strong></a>
                            <span class="sortorder fa" ng-show="feedbackReport.predicateTotals === 'total_responded_to_me'" ng-class="feedbackReport.reverseTotals ? 'fa-caret-up' : 'fa-caret-down'"></span>
                        </th>
                        <th>
                            <a href="" ng-click="feedbackReport.orderTotals('total_requested_of_me');"><strong>Requested of Me</strong></a>
                            <span class="sortorder fa" ng-show="feedbackReport.predicateTotals === 'total_requested_of_me'" ng-class="feedbackReport.reverseTotals ? 'fa-caret-up' : 'fa-caret-down'"></span>
                        </th>
                        <th>
                            <a href="" ng-click="feedbackReport.orderTotals('total_i_responded_to');"><strong>I Responded To</strong></a>
                            <span class="sortorder fa" ng-show="feedbackReport.predicateTotals === 'total_i_responded_to'" ng-class="feedbackReport.reverseTotals ? 'fa-caret-up' : 'fa-caret-down'"></span>
                        </th>
                        <th>
                            <a href="" ng-click="feedbackReport.orderTotals('total_unrequested_i_gave');"><strong>Unsolicited I Gave</strong></a>
                            <span class="sortorder fa" ng-show="feedbackReport.predicateTotals === 'total_unrequested_i_gave'" ng-class="feedbackReport.reverseTotals ? 'fa-caret-up' : 'fa-caret-down'"></span>
                        </th>
                        <th>
                            <a href="" ng-click="feedbackReport.orderTotals('total_unrequested_given_to_me');"><strong>Unsolicited I Received</strong></a>
                            <span class="sortorder fa" ng-show="feedbackReport.predicateTotals === 'total_unrequested_given_to_me'" ng-class="feedbackReport.reverseTotals ? 'fa-caret-up' : 'fa-caret-down'"></span>
                        </th>
                        <th>
                            <a href="" ng-click="feedbackReport.orderTotals('total_digests_i_delivered');"><strong>Digests I Delivered</strong></a>
                            <span class="sortorder fa" ng-show="feedbackReport.predicateTotals === 'total_digests_i_delivered'" ng-class="feedbackReport.reverseTotals ? 'fa-caret-up' : 'fa-caret-down'"></span>
                        </th>
                        <th>
                            <a href="" ng-click="feedbackReport.orderTotals('total_digests_i_received');"><strong>Digests I Received</strong></a>
                            <span class="sortorder fa" ng-show="feedbackReport.predicateTotals === 'total_digests_i_received'" ng-class="feedbackReport.reverseTotals ? 'fa-caret-up' : 'fa-caret-down'"></span>
                        </th>
                        <th>
                            <a href="" ng-click="feedbackReport.orderTotals('total_i_gave_that_was_helpful');"><strong>I Gave Helpful Feedback</strong></a>
                            <span class="sortorder fa" ng-show="feedbackReport.predicateTotals === 'total_i_gave_that_was_helpful'" ng-class="feedbackReport.reverseTotals ? 'fa-caret-up' : 'fa-caret-down'"></span>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="report in feedbackReport.reportTotals | orderBy:feedbackReport.predicateTotals:feedbackReport.reverseTotals">
                        <td>{{ $index+1 }}.</td>
                        <td>
                            <a ng-href="#/employees/{{report.employee.id}}" class="tiny-headshot pull-left"><img ng-src="{{ report.employee.avatar_small }}" alt="{{ report.employee.full_name }}'s avatar"/></a>
                            <a href="#/employees/{{report.employee.id}}">{{report.employee.full_name}}</a>
                        </td>
                        <td style="text-align: center">{{report.total_i_requested}}</td>
                        <td style="text-align: center">{{report.total_responded_to_me}}</td>
                        <td style="text-align: center">{{report.total_requested_of_me}}</td>
                        <td style="text-align: center">{{report.total_i_responded_to}}</td>
                        <td style="text-align: center">{{report.total_unrequested_i_gave}}</td>
                        <td style="text-align: center">{{report.total_unrequested_given_to_me}}</td>
                        <td style="text-align: center">{{report.total_digests_i_delivered}}</td>
                        <td style="text-align: center">{{report.total_digests_i_received}}</td>
                        <td style="text-align: center">{{report.total_i_gave_that_was_helpful}}</td>
                    </tr>
                    <tr>
                        <td><strong>Totals</strong></td>
                        <td>
                        </td>
                        <td style="text-align: center"><strong>{{feedbackReport.total_i_requested_total}}</strong></td>
                        <td style="text-align: center"><strong>{{feedbackReport.total_responded_to_me_total}}</strong></td>
                        <td style="text-align: center"><strong>{{feedbackReport.total_requested_of_me_total}}</strong></td>
                        <td style="text-align: center"><strong>{{feedbackReport.total_i_responded_to_total}}</strong></td>
                        <td style="text-align: center"><strong>{{feedbackReport.total_unrequested_i_gave_total}}</strong></td>
                        <td style="text-align: center"><strong>{{feedbackReport.total_unrequested_given_to_me_total}}</strong></td>
                        <td style="text-align: center"><strong>{{feedbackReport.total_digests_i_delivered_total}}</strong></td>
                        <td style="text-align: center"><strong>{{feedbackReport.total_digests_i_received_total}}</strong></td>
                        <td style="text-align: center"><strong>{{feedbackReport.total_i_gave_that_was_helpful}}</strong></td>
                    </tr>
                </tbody>
            </table>
            <div ng-show="busy" class="no-results"><img src="../static/images/loader.gif" alt="Loading spinner" /></div>
        </div>
        <div class="panel" ng-show="feedbackReport.reportTimestamps.length>0 && feedbackReport.reportType=='timestamps'">
            <button class="btn btn-default pull-right" type="button" ng-csv="feedbackReport.csvTimestamps" filename="feedback-report-timestamps{{feedbackReport.startDate | date:'yyyy-MM-dd'}}to{{feedbackReport.endDate | date:'yyyy-MM-dd'}}.csv" csv-header="['Employee Id', 'Employee', 'Feedback Request Date', 'Feedback Expiration Date', 'Feedback Giver Id',  'Feedback Giver', 'Feedback Date']">
                <span class="fa fa-download"></span> Download
            </button>

            <table class="table">
                <thead>
                    <tr>
                        <th></th>
                        <th>
                            <a href="" ng-click="feedbackReport.orderTimestamps('requester.full_name');"><strong>Employee</strong></a>
                            <span class="sortorder fa" ng-show="feedbackReport.predicateTimestamps === 'requester.full_name'" ng-class="feedbackReport.reverseTimestamps ? 'fa-caret-up' : 'fa-caret-down'"></span>
                        </th>
                        <th>
                            <a href="" ng-click="feedbackReport.orderTimestamps('request_date');"><strong>Feedback Request Date</strong></a>
                            <span class="sortorder fa" ng-show="feedbackReport.predicateTimestamps === 'request_date'" ng-class="feedbackReport.reverseTimestamps ? 'fa-caret-up' : 'fa-caret-down'"></span>
                        </th>
                        <th>
                            <a href="" ng-click="feedbackReport.orderTimestamps('expiration_date');"><strong>Feedback Request Expiration Date</strong></a>
                            <span class="sortorder fa" ng-show="feedbackReport.predicateTimestamps === 'expiration_date'" ng-class="feedbackReport.reverseTimestamps ? 'fa-caret-up' : 'fa-caret-down'"></span>
                        </th>
                        <th>
                            <a href="" ng-click="feedbackReport.orderTimestamps('reviewer.full_name');"><strong>Feedback Giver</strong></a>
                            <span class="sortorder fa" ng-show="feedbackReport.predicateTimestamps === 'reviewer.full_name'" ng-class="feedbackReport.reverseTimestamps ? 'fa-caret-up' : 'fa-caret-down'"></span>
                        </th>
                        <th>
                            <a href="" ng-click="feedbackReport.orderTimestamps('submission.feedback_date');"><strong>Feedback Date</strong></a>
                            <span class="sortorder fa" ng-show="feedbackReport.predicateTimestamps === 'submission.feedback_date'" ng-class="feedbackReport.reverseTimestamps ? 'fa-caret-up' : 'fa-caret-down'"></span>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="request in feedbackReport.reportTimestamps | orderBy:feedbackReport.predicateTimestamps:feedbackReport.reverseTimestamps">
                        <td>{{ $index+1 }}.</td>
                        <td>
                            <a ng-href="#/employees/{{request.requester.id}}" class="tiny-headshot pull-left"><img ng-src="{{ request.requester.avatar_small }}" alt="{{ request.requester.full_name }}'s avatar"/></a>
                            <a href="#/employees/{{request.requester.id}}">{{request.requester.full_name}}</a>
                        </td>
                        <td style="text-align: center">{{request.request_date | date:'MM/dd/yyyy'}}<span ng-if="!request.request_date" style="color: #bbb;">--</span></td>
                        <td style="text-align: center">{{request.expiration_date | date:'MM/dd/yyyy'}}<span ng-if="!request.expiration_date" style="color: #bbb;">--</span></td>
                        <td>
                            <a ng-href="#/employees/{{request.reviewer.id}}" class="tiny-headshot pull-left"><img ng-src="{{ request.reviewer.avatar_small }}" alt="{{ request.reviewer.full_name }}'s avatar"/></a>
                            <a href="#/employees/{{request.reviewer.id}}">{{request.reviewer.full_name}}</a>
                        </td>
                        <td style="text-align: center">{{request.submission.feedback_date | date:'MM/dd/yyyy'}}<span ng-if="!request.submission" style="color: #bbb;">--</span></td>
                    </tr>
                </tbody>
            </table>
            <div ng-show="busy" class="no-results"><img src="../static/images/loader.gif" alt="Loading spinner" /></div>
        </div>
    </div>
</div>

<div id="feedback" class="container">
    <div>
        <div class="header-links hide-for-mobile-and-tablet pull-right">
            <a href="" data-toggle="modal" data-target=".feedback-welcome-modal" class="show-welcome-modal">Show welcome message</a>
            <a target="_blank" href="https://fool.slack.com/messages/scoutmap-feedback/">Tell us what you think!</a>
        </div>
        <h1>Feedback
            <div class="button-group">
                <button class="btn btn-success btn-feedback" ng-click="feedback.requestFeedback()" type="button"><i class="fa fa-comment"></i> Ask <span class="hide-for-mobile">for Feedback</span></button>
                <button class="btn btn-success btn-feedback" ng-click="feedback.giveUnsolicitedFeedback()" type="button"><i class="fa fa-pencil"></i> Give <span class="hide-for-mobile">Feedback</span></button>
            </div>
        </h1>
    </div>  
    <div class="panel panel-empty fade-in" ng-show="feedback.showEmptyScreen">
        <img class="grumpycat" src="../static/images/grumpycat.png" alt="Grumpy Cat" />
        <h2>"Mmmmeeh... i see you don't have any activity yet. Use the buttons above or these links to 
            <a href="" ng-click="feedback.requestFeedback()">ask for feedback</a> or 
            <a href="" ng-click="feedback.giveUnsolicitedFeedback()">give someone feedback</a>.""
        </h2>
    </div>    
    
    <!-- Feedback successfully sent message -->
    <div ng-class="{'slide-up-active': hideMessage}" class="alert alert-success slide-up" role="alert" ng-show="successMessage">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <i class="fa fa-paper-plane sent-icon"></i>
        <h2 class="alert-title">Congratulations!</h2>
        <p class="alert-message">Your feedback is in-flight and will be delivered to {{ successMessageRecipient.full_name }}'s feedback coach.</p>    
    </div>

    <!-- Feedback request message -->
    <div ng-class="{'slide-up-active': hideRequestMessage}" class="alert alert-success slide-up" role="alert" ng-show="successRequestMessage">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <i class="fa fa-paper-plane sent-icon"></i>
        <h2 class="alert-title">Request<span ng-show="successRequestMessageRecipient.length>1">s</span> Sent!</h2>
        <p class="alert-message">
            Your request for feedback has been sent to 
            <span ng-repeat="employee in successRequestMessageRecipient">{{ employee.full_name }}{{$last ? '' : ($index==successRequestMessageRecipient.length-2) ? ' and ' : ', '}}</span>.
        </p>    
    </div>    

    <div class="panel" ng-show="feedback.feedbackRequests.length>0">
        <table class="table responsive-table">
            <caption class="panel-title">
                {{ feedback.feedbackRequests.length }} 
                <span ng-show="feedback.feedbackRequests.length == 1">Person wants</span> 
                <span ng-show="feedback.feedbackRequests.length != 1">People want</span> 
                feedback
            </caption>
            <thead>
                <tr>
                  <th scope="col" class="width-15-percent">Person</th>
                  <th scope="col" class="width-15-percent">Sent</th>
                  <th scope="col" class="width-40-percent hide-for-mobile-and-tablet">Where they'd like feedback</th>
                  <th scope="col" class="width-15-percent centered">Action</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="request in feedback.feedbackRequests | orderBy:'request.requester.full_name'">
                    <td>
                        <span class="tiny-headshot">
                            <img class="headshot-image" ng-src="{{ request.requester.avatar_small }}" alt="{{ request.requester.full_name }}'s avatar" />
                        </span>  
                        <span>{{ request.requester.full_name }}</span>
                    </td>
                    <td class="timeago">{{ request.request_date | fromNow }}</td>
                    <td class="message hide-for-mobile-and-tablet">{{ request.message }}</td>    
                    <td class="right-align">
                        <a class="btn btn-default btn-md give-feedback-btn" ng-href="#/feedback/request/{{ request.id }}/reply/" type="button">
                            <i class="fa fa-pencil"></i> Give Feedback
                        </a>
                    </td>
                </tr>
                <tr ng-show="!feedback.feedbackRequests.length">
                    <td colspan="4">You currently don't have any requests for feedback.</td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="panel" ng-show="feedback.myRecentlySentRequests.length">
        <table class="table responsive-table">
            <caption class="panel-title">People I've asked for feedback</caption>
            <thead>
                <tr>
                  <th scope="col" class="width-15-percent">Person</th>
                  <th scope="col" class="width-15-percent">Sent</th>
                  <th scope="col" class="width-40-percent hide-for-mobile-and-tablet">Where you'd like feedback</th>
                  <th scope="col" class="width-15-percent centered">Completed</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="request in feedback.myRecentlySentRequests | reverse">
                    <td>
                        <span class="tiny-headshot">
                            <img class="headshot-image" ng-src="{{ request.reviewer.avatar_small }}" alt="{{ request.reviewer.full_name }}'s avatar" />
                        </span>
                        <span>{{ request.reviewer.full_name }}</span>
                    </td>
                    <td class="timeago">
                        {{ request.request_date | fromNow }}
                    </td>
                    <td class="message hide-for-mobile-and-tablet">
                        <p style="white-space:pre-line">{{ request.message }}</p>
                    </td>                          
                    <td class="centered">
                        <i ng-show="{{ request.has_been_answered }}" class="fa fa-check" title="Completed"></i>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="panel" ng-show="feedback.mySubmissions.length">
        <table class="table responsive-table">
            <caption class="panel-title">People I've given feedback to</caption>
            <thead>
                <tr>
                  <th scope="col" class="width-15-percent">Person</th>
                  <th scope="col" class="width-15-percent">Sent</th>
                  <th scope="col" class="width-40-percent hide-for-mobile-and-tablet left-aligned">Anonymous</th>
                  <th scope="col" class="width-15-percent centered">Action</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="submission in feedback.mySubmissions | reverse">
                    <td>
                        <span class="tiny-headshot">
                            <img class="headshot-image" ng-src="{{ submission.subject.avatar_small }}" alt="{{ submission.subject.full_name }}'s avatar" />
                        </span>
                        {{ submission.subject.full_name }}
                    </td>
                    <td class="timeago">
                        {{ submission.feedback_date | fromNow }}
                    </td>
                    <td class="left-aligned hide-for-mobile-and-tablet">
                        <i ng-show="{{ submission.anonymous }}" class="fa fa-check" title="Anonymous"></i>
                    </td>
                    <td class="centered">
                        <a class="btn btn-default btn-md" ng-href="#/feedback/submission/{{ submission.id }}/" type="button">
                            <i class="fa fa-eye"></i> View Feedback
                        </a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <div style="padding-top:20px" ng-repeat="digest in feedback.myDigests | orderBy:'delivery_date':true">
        <div class="panel">
            <a id="digest{{ digest.id }}"></a>
            <h2 class="panel-title" style="margin-bottom:0">360 Feedback- {{ digest.delivery_date | date:'longDate' }}</h2>
            <span style="color: #aaa;font-style: italic;">Delivered by: {{ digest.delivered_by.full_name }}</span>
            <div ng-show="digest.summary">
                <h3 style="margin-top:25px;margin-bottom:15px;">Summary from your Coach</h3>
                <p style="white-space: pre-line;">{{ digest.summary }}</p>
            </div>
            <h3 style="margin-top:25px">{{ feedback.questions.excelsAtQuestion }}</h3>
            <table class="table table-striped" style="margin-bottom:45px">
                <thead>
                    <tr>
                      <th style="width:20%"></th>
                      <th class="centered" style="width:70%"></th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="submission in digest.submissions">
                        <td ng-show="!submission.anonymous">
                            <span class="tiny-headshot">
                                <img class="headshot-image" ng-src="{{ submission.reviewer.avatar_small }}" alt="{{ submission.reviewer.full_name }}'s avatar" />
                            </span>
                            {{ submission.reviewer.full_name }}
                            {{ submission.requester.full_name }}
                        </td>
                        <td ng-show="submission.anonymous">
                                <span class="tiny-headshot">
                                    <img src="//hippoculture.s3.amazonaws.com/media/avatars/geneRick.jpg"/>
                                </span>
                            Anonymous
                        </td>
                        <td style="white-space: pre-line;">
                            {{ submission.excels_at }}
                        </td>
                    </tr>
                </tbody>
            </table>
            <h3>{{ feedback.questions.couldImproveOnQuestion }}</h3>
            <table class="table table-striped" style="margin-bottom:45px">
                <thead>
                    <tr>
                      <th style="width:20%"></th>
                      <th class="centered" style="width:70%"></th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="submission in digest.submissions">
                        <td ng-show="!submission.anonymous">
                            <span class="tiny-headshot">
                                <img class="headshot-image" ng-src="{{ submission.reviewer.avatar_small }}" alt="{{ submission.reviewer.full_name }}'s avatar" />
                            </span>
                            {{ submission.reviewer.full_name }}
                            {{ submission.requester.full_name }}
                        </td>
                        <td ng-show="submission.anonymous">
                                <span class="tiny-headshot">
                                    <img src="//hippoculture.s3.amazonaws.com/media/avatars/geneRick.jpg"/>
                                </span>
                            Anonymous
                        </td>
                        <td style="white-space: pre-line;">
                            {{ submission.could_improve_on }}
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div ng-include="'/static/angular/partials/feedback/_modals/welcome-message.html'"></div>
</div>
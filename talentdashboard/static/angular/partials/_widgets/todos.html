<div class="panel todos" ng-if="currentUser.can_view_comments" ng-init="showToDo=true">
    <div ng-controller="MyToDoListCtrl">
        <h2 class="panel-title">My To Do's</h2> 
        <div ng-if="todos.length > 0">
            <ul class="nav nav-tabs">
                <li role="presentation" ng-class="{'active': showToDo}"><a href="javascript:void(0);" ng-click="showToDo=true;showDone=false">To Do</a></li>
                <li role="presentation" ng-class="{'active': showDone}"><a href="javascript:void(0);" ng-click="showToDo=false;showDone=true">Done</a></li>
            </ul>
        </div>
        <div ng-show="showToDo">
            <div ng-show="todos.length==0" class="todos-empty">
                <p>You currently don't have any tasks. Add Todos on employee profile pages.</p>
            </div>
            <div ng-if="todos.length > 0">
                <div class="row shaded">
                    <div class="col-xs-7">Tasks</div>
                    <div class="col-xs-3">Assigned by</div>
                    <div class="col-xs-2">Date</div>
                </div>    
                <div class="row todo" ng-repeat="todo in todos" ng-controller="EmployeeToDoCtrl" ng-init="currentToDo=todo">
                    <div class="col-xs-7">
                        <input class="todo-checkbox" show="{{scrollIntoView}}" ng-scroll-into-view type="checkbox" ng-click="saveToDo(todo)" ng-model="todo.completed">
                        <textarea ng-model="todo.description" focus-me="todo.edit" ng-enter="saveToDo();scrubToDo(todo);" ng-blur="saveToDo();scrubToDo(todo);" ng-show="todo.edit"  placeholder="Add a To Do..."></textarea>
                        <div ng-show="!todo.edit" ng-class="{'todo-completed': todo.completed}">
                            <a ng-href="/#/employees/{{todo.employee.id}}">
                                <img alt="{{todo.employee.full_name}}" ng-src="{{ todo.employee.avatar_small }}" class="small-headshot" /> 
                            </a>
                            <p>{{todo.description}}</p>
                        </div>
                    </div>  
                    <div class="col-xs-3">  
                        <a ng-click="toggleAssigneeMenu()">{{todo.assigned_to.full_name||"Unassigned"}}</a>
                        <div ng-show="openAssigneeMenu" style="border: 1px solid #ccc;padding: 8px 3px;border-radius: 4px;background-color:#efefef;margin-bottom:10px;">
                            <div class="assignee-arrow-border"></div>
                            <div class="assignee-arrow"></div>
                            <ul>
                                <li class="assignee-select"><a class="assignee-select-link" ng-click="assigneeMenu.show=false;todo.assigned_to=null;saveToDo()">Unassigned</a></li>
                                <li class="assignee-select" ng-repeat="assignee in assignees | orderBy:'full_name'">
                                    <a class="assignee-select-link" ng-click="assigneeMenu.show=false;todo.assigned_to=assignee;saveToDo()" style="cursor: pointer;">{{assignee.full_name}}</a>
                                </li>
                            </ul>
                        </div> 
                    </div>
                    <div class="col-xs-2">    
                        <a ng-click="open($event);closeAssigneeMenu()">{{(todo.due_date | date:'MMM d') || "No due date"}}</a>
                        <span type="text" datepicker-popup="{{format}}" ng-model="todo.due_date" is-open="opened" min="minDate" datepicker-options="" date-disabled="disabled(date, mode)" show-weeks="false" ng-required="true" close-text="Close"/>
                        
                        <i class="fa fa-cog show-popover pull-right"></i>
                        <ul class="popover-items" style="display:none">
                            <li class="popover-item">
                                <i class="fa fa-pencil-square-o"></i> 
                                <a ng-show="!todo.edit" ng-click="todo.edit=true">Edit</a>
                                <a ng-show="todo.edit" ng-click="todo.edit=false">Edit</a>
                            </li>
                            <li class="popover-item">
                                <i class="fa fa-trash-o"></i> 
                                <a ng-click="deleteToDo(todo)">Delete</a>
                            </li>
                        </ul>
                    </div>      
                </div>
            </div>        
        </div>
        <div ng-show="showDone" class="widget-body text-widget" style="padding:12px;margin-top:20px;">
            <span ng-show="completed_todos.length==0">Empty</span>
            <div ng-if="completed_todos.length > 0">
                <div ng-repeat="todo in completed_todos" ng-controller="EmployeeToDoCtrl" ng-init="currentToDo=todo">
                    <input show="{{scrollIntoView}}" ng-scroll-into-view type="checkbox" ng-click="saveToDo(todo)" ng-model="todo.completed" style="padding: 5px;float: left;">

                    <div ng-show="!todo.edit" ng-class="{'todo-completed': todo.completed}" style="display:inline-block;width: 260px;float:left;margin-top: 3px;margin-left: 2px;padding-bottom: 3px;"><a ng-href="/#/employees/{{todo.employee.id}}">({{todo.employee.full_name}}) {{todo.description}}</a></div>
                    <ul class="feed-actions" style="margin-left: 2px;margin-top:0px;">
                        <li class="feed-action">{{todo.assigned_to.full_name||"Unassigned"}}</li>
                        <span style="color:#8b8b8b;">{{(todo.due_date | date:'MMM d, yyyy') || "No due date"}}</span>
                    </ul>
                    <span type="text" class="form-control" datepicker-popup="{{format}}" ng-model="todo.due_date" is-open="opened" min="minDate" datepicker-options="" date-disabled="disabled(date, mode)" show-weeks="false" ng-required="true" close-text="Close"/>
                    <div style="clear:both;"></div>
                </div>
            </div>
        </div>
    </div>
</div>
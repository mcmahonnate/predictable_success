<div ng-include="'/static/angular/partials/header.html'"></div>
<div class="container narrow-gutter" style="margin-top:85px">    

    <div class="row">
        <a href="" class="pull-right download-report-link"><i class="fa fa-download"></i> Download Report</a>
        <h1>{{ team_name }} </h1>
        <div class="col col-sm-5 col-md-4 col-lg-5">

            <!-- Pie Chart -->
            <div class="panel talent-portfolio row"> 
                <h2 class="panel-title">Talent Portfolio</h2>
                <div class="talent-pie-chart-container"> 
                    <div x-talent-category-chart size="small" style="width: 100%; height: 100%;"></div>
                </div>
            </div>

            <!-- Total Salary -->
            <div class="panel row">
                <h2 class="panel-title">Total Salaries</h2>    
                <span class="total">{{salaryReport.total_salaries | currency | noCents }}</span>
            </div>

            <!-- Salary totals by segment -->
            <div class="panel salary-totals row stripes">
                <h2 class="panel-title">Salaries by Talent</h2>
                <div class="salary-total-type" ng-repeat="(category, salaries) in salaryReport.categories track by $index">       
                    <i class="glyphicon glyphicon-user pull-left user-segment user-segment-color-{{category}}"></i>
                    <span class="salary-total-amount">{{salaries | currency | noCents }}</span>
                </div>
            </div>

            <!-- Team Leads -->
            <div class="panel talent-portfolio row">
                <h2 class="panel-title">Team Leads</h2>
                <div ng-controller="TeamLeadsCtrl" ng-init="init(teamId)">
                    <div class="team-lead" ng-repeat="evaluation in teamLeads | orderBy:'talent_category'">
                        <a class="avatar-container" ng-if="evaluation.employee.display" href="#/employees/{{evaluation.employee.id}}">
                            <img ng-src="{{ evaluation.employee.avatar_small }}" class="medium-round-avatar" />
                            <span title="{{evaluation.talent_category}}" class="team-lead-segment user-segment-background-color-{{evaluation.talent_category}}"></span>
                        </a>
                        <a class="team-lead-name" ng-if="evaluation.employee.display" href="#/employees/{{evaluation.employee.id}}">
                            {{evaluation.employee.full_name}}
                        </a>    
                    </div>
                </div>
            </div>
        </div> 


        <div class="col-sm-7 col-md-8 col-lg-7">     
            <div ng-controller="TeamCommentsCtrl" ng-class="{'showflip': show_discussions}">
 
                <!-- Comments -->
                <div class="comments" ng-if="currentUser.can_view_comments" >
                    <div class="comment panel" ng-repeat="comment in comments | orderBy:'created_date':true">
                        <h2 class="panel-title" ng-show="$first">Discussions</h2>
                        <h3 ng-show="CreateHeader(comment.created_date)" class="comments-date">{{comment.created_date | date:'MMM d, yyyy'}}</h3>      
                        <div class="comment-owner-avatar-container">
                            <a ng-href="#/employees/{{comment.owner.employee.id}}">
                                <img ng-src="{{ comment.owner.employee.avatar_small }}" class="comment-owner-avatar" />
                            </a>
                        </div>
                        <div class="comment-item">
                            <div class="comment-title">
                                <a ng-href="#/employees/{{comment.owner.employee.id}}" class="comment-title-employee-name">{{comment.owner.employee.full_name}}</a> 
                                commented on 
                                <a ng-href="#/employees/{{comment.associated_object.id}}" class="comment-title-employee-name">{{comment.associated_object.full_name}}</a>
                                <span class="timestamp" title="{{comment.created_date | date:'MMM d, yyyy h:mma'}}">{{comment.created_date | fromNow }}</span>
                            </div>
                            <div ng-show="showCommentEdit" class="comment-editor">
                                <textarea ng-model="comment.content" class="form-control"></textarea>
                                <label class="radio " style="position: relative;padding-left: 0px">
                                    Share with:
                                </label>
                                <label class="radio " style="position: relative">
                                    <input class="radio custom-radio" ng-model="comment.visibility" name="visibilitOptions{{$index}}" value="3" type="radio" style="cursor: pointer;">
                                    <span class="icons"><span class="icon-unchecked"></span><span class="icon-checked"></span></span>
                                    Everyone
                                </label>
                                <label ng-show="showPeopleTeamVisibility" class="radio" style="position: relative">
                                    <input class="radio custom-radio" ng-model="comment.visibility" name="visibilitOptions{{$index}}" value="2" type="radio" style="cursor: pointer;">
                                    <span class="icons"><span class="icon-unchecked"></span><span class="icon-checked"></span></span>
                                    Hide from Manager
                                </label>
                                <label class="radio" style="position: relative">
                                    <input class="radio custom-radio" ng-model="comment.visibility" name="visibilitOptions{{$index}}" value="1" type="radio" style="cursor: pointer;">
                                    <span class="icons"><span class="icon-unchecked"></span><span class="icon-checked"></span></span>
                                    Just Me
                                </label>
                                <happiness show="true" happy="comment.happiness"></happiness>
                                <div id="editActions" style="right:2px;bottom:-33px;">
                                    <button class="button small blue" ng-disabled="!comment.content" ng-click="saveComment(comment);showCommentEdit=false">Save</button>
                                    <button class="button small orange" ng-click="cancelEditComment(comment);showCommentEdit=false">Cancel</button>
                                </div>
                            </div>

                            <div class="comment-copy" ng-show="!showCommentEdit">
                                <a ng-href="#/employees/{{comment.associated_object.id}}" style="cursor: pointer;color:#8b8b8b;">
                                    <img ng-src="{{ comment.associated_object.avatar_small }}" class="comment-associated-avatar"/>
                                </a>
                                <span ng-init="length=500" ng-bind-html="comment.content | new_line | cut:true:length" style="line-height: 125%"></span> <span ng-show="comment.content.length>length" ng-init="showMoreButton=true"><a ng-click="length=0;showMoreButton=false;" ng-show="showMoreButton" style="color: #8b8b8b;cursor: pointer">more</a><a ng-click="length=500;showMoreButton=true" ng-show="!showMoreButton" style="color: #8b8b8b;cursor: pointer">less</a></span>   
                                <span class="total-replies" ng-show="comment.subcomments.length>0">
                                    {{comment.subcomments.length}} reply
                                </span>

                                <ul class="comment-actions">
                                    <li ng-show="comment.owner.id==currentUser.id" class="feed-action">
                                        <a ng-click="showCommentEdit=true">edit</a>
                                    </li>
                                    <li ng-show="comment.owner.id==currentUser.id" class="feed-action">
                                        <a ng-click="deleteComment(comment)">delete</a>
                                    </li>
                                </ul>

                            </div>
                        </div>
       
                        <div class="comment-replies" ng-show="showCommentInput || comment.subcomments">
                            <div class="comment-reply" ng-repeat="subcomment in comment.subcomments | orderBy:'created_date'">
                                <ul class="feed-actions pull-right">
                                    <li ng-show="subcomment.owner.id==currentUser.id" class="feed-action"><a ng-click="showSubCommentEdit=true" class="feed-action">Edit</a></li>
                                    <li ng-show="subcomment.owner.id==currentUser.id" class="feed-action"><a ng-click="deleteSubComment(comment, subcomment)" class="feed-action">Delete</a></li>
                                </ul>                            
                                <div class="comment-reply-avatar-container">
                                    <a ng-href="#/employees/{{subcomment.owner.employee.id}}">
                                        <img class="comment-reply-avatar" ng-src="{{ subcomment.owner.employee.avatar_small }}"/>
                                    </a>
                                </div>
                                <a class="comment-reply-name" ng-href="#/employees/{{subcomment.owner.employee.id}}">{{subcomment.owner.employee.full_name}}</a> 
                                <span class="timestamp" title="{{subcomment.created_date | date:'MMM d, yyyy h:mma' }}">{{subcomment.created_date | fromNow }}</span>     
                                <div class="comment-reply-copy" ng-show="showSubCommentEdit">
                                    <textarea ng-model="subcomment.content" ></textarea>
                                    <div id="editActions" style="right:2px;bottom:-33px;">
                                        <button class="button small blue" ng-disabled="!subcomment.content" ng-click="saveSubComment(subcomment, comment);showSubCommentEdit=false">Save</button>
                                        <button class="button small orange" ng-click="cancelEditSubComment(subcomment, comment);showSubCommentEdit=false">Cancel</button>
                                    </div>
                                </div>
                                <div class="comment-reply-copy" ng-show="!showSubCommentEdit">
                                    <span ng-init="length=500" data-ng-bind-html="subcomment.content | new_line | cut:true:length"></span> 
                                    <span ng-show="subcomment.content.length>length" ng-init="showMoreButton=true">
                                        <a ng-click="length=0;showMoreButton=false;" ng-show="showMoreButton" style="color: #8b8b8b;cursor: pointer">more</a>
                                        <a ng-click="length=500;showMoreButton=true" ng-show="!showMoreButton" style="color: #8b8b8b;cursor: pointer">less</a>
                                    </span>
                                </div>
                            </div>
                            <div ng-show="showCommentInput || comment.subcomments" class="comment-reply-textarea">
                                <textarea class="text" 
                                    ng-model="comment.newSubCommentText" 
                                    ng-class="{'expand': comment.expandTextArea, 'compress': !comment.expandTextArea}" 
                                    ng-click="comment.expandTextArea=true;toggleChildCommentTextExpander(comment)" 
                                    rows="1" cols="40" 
                                    placeholder="Add a comment..." >
                                </textarea>
                                <button class="small-comment" ng-disabled="!comment.newSubCommentText" ng-click="addSubComment(comment);expandTextArea=false">Comment</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>     
        </div>
      </div>
  </div>

    <a class="feedback-button" data-toggle="modal" data-target="#feedback">
        Feedback
    </a>

    <!-- Modal -->
    <div class="modal feedback-modal fade" id="feedback" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <img class="headshot" src="../static/images/doug.jpg" alt="Doug Dosberg" />
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <div class="modal-body">
                    <h4 class="modal-title">Hey! It's Doug. </h4>
                    <p class="modal-subtext">Your feedback is very important to us. Help us improve Scoutmap by dropping a note below. Thanks! </p>
                    <textarea class="form-control modal-textarea"></textarea> 
                </div>
                <button type="button" class="btn btn-success modal-btn">Send Feedback</button>
            </div>
        </div>
    </div>